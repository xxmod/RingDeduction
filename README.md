# Ring Deduction

> Apex Legends 缩圈预测工具。通过分析游戏地图截图中的缩圈位置，在预生成的参考图库中找到最匹配的圈配置，从而预测后续缩圈走向。本项目大部分代码由AI生成。

## 原理

游戏中缩圈外的区域会叠加灰暗蒙版，导致圈内比圈外更亮。程序将参考图库中每个已知圈位置投影到截图上，计算圈内外亮度差（对比度），差值最大的即为最佳匹配。

## 支持地图

- `broken-moon` — 破碎月球（326 种圈配置）
- `world's-edge` — 世界尽头（48 种圈配置）

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 配置地图

编辑 `.env` 文件，设置当前地图：

```dotenv
MAP=broken-moon
```

### 3. 运行

将游戏地图截图放入 `screenshot/` 目录，然后运行：

```bash
python main.py
```

程序会自动选取最新的截图进行分析，并打开最匹配的参考图。

## 命令行参数

| 参数              | 说明                           |
| ----------------- | ------------------------------ |
| `--file <路径>` | 指定截图文件，而非自动选取最新 |
| `--rebuild`     | 强制重建参考图缓存             |
| `--no-debug`    | 关闭调试图输出                 |

```bash
# 指定截图
python main.py --file screenshot/example.png

# 重建缓存
python main.py --rebuild

# 组合使用
python main.py --file screenshot/example.png --no-debug
```

## 目录结构

```
RingDeduction/
├── .env                        # 地图配置（MAP=地图名）
├── main.py                     # 主程序
├── requirements.txt            # Python 依赖
├── screenshot/                 # 游戏截图（放入此目录）
├── map/
│   ├── broken-moon/            # 破碎月球参考图
│   └── world's-edge/           # 世界尽头参考图
├── broken-moon-cache.json      # 破碎月球缓存（自动生成）
├── world's-edge-cache.json     # 世界尽头缓存（自动生成）
└── debug/                      # 调试输出图（自动生成）
    ├── detected_ring.jpg       # 检测到的圈可视化
    └── comparison.jpg          # 截图与匹配结果对比
```

## 输出示例

```
[INFO] 当前地图: broken-moon
[INFO] 截图尺寸: 1920×1080
[INFO] 裁剪: (489,37)-(1430,977) -> 941×940
[INFO] 已加载缓存: 326 条记录

==========================================================
  #    文件名                  得分         圆心                 半径
----------------------------------------------------------
  1    frame_0304.jpg       21.2746    (0.687,0.578)     0.357
  2    frame_0301.jpg       20.4829    (0.682,0.626)     0.358
  3    frame_0303.jpg       15.1827    (0.709,0.616)     0.356
==========================================================
[INFO] 最佳匹配: frame_0304.jpg (得分: 21.2746)
```

## 注意事项

- 截图需为 **全屏地图界面**（按 M 键打开的大地图），分辨率建议 1920×1080
- 首次运行某张地图时会自动构建缓存，耗时约数十秒至几分钟
- 后续运行直接读取缓存，通常 1-2 秒内完成
- 支持中文路径的截图文件名
